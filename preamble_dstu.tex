%
% ПРЕАМБУЛА ДЛЯ ОФОРМЛЕНИЯ СОГЛАСНО
% ДСТУ3008:2015
%

%TODO: comment all thing for better understanding

\nonstopmode
%\usepackage{extsizes}

%\usepackage{cmap} % для кодировки шрифтов в pdf
\usepackage{lmodern}
\usepackage{calc} % калькулятор (операторы +- и т.п.)
\usepackage{scrextend}
\usepackage[no-math]{fontspec} % костыль
\usepackage{mathspec}
\usepackage{xunicode,xltxtra} % не мешает вроде
\usepackage{mathptmx}


% ПОЛИГЛОССИЯ
\usepackage{polyglossia} % на замену babel
\setmainlanguage{ukrainian}
\defaultfontfeatures{Mapping=tex-text} % чтобы работали "---" и прочее
\setotherlanguages{english, russian}
\newfontfamily\cyrillicfont[Script=Cyrillic]{Times New Roman}
\newfontfamily\cyrillicfonttt[Script=Cyrillic]{Times New Roman}

% СТАВИМ ШРИФТЫ
\setmainfont[Scale=1]{Times New Roman} % .976
\setmathfont(Digits,Latin,Greek)[Scale=1, Numbers={Lining,Proportional}]{Times New Roman}
\setmonofont{Times New Roman}
\linespread{1.5} % 1.464
% делаем чтобы запятые в формулах были тоже таймс нью роман
%\usepackage[output-decimal-marker=\textrm{,}]{siunitx}
%\renewcommand\materialfont{\sffamily\fontsize{7pt}{\baselineskip}\selectfont}
\usepackage{siunitx}
\sisetup{
  list-final-separator = { і },
  list-pair-separator  = { і },
  range-phrase         = { до },
  output-decimal-marker = {,},
  per-mode              = symbol,
  detect-weight=true,
  detect-family=true,
  group-digits = integer,
  group-minimum-digits = 3,
  group-separator = \text{~}
}
\input{mySIunits}
\usepackage{icomma}
\begingroup
\lccode`\~`\,\lowercase{\endgroup
\def~{\mathpunct{\textrm{,}}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{array}
\usepackage{graphicx} % для вставки картинок
\let\varTheta\undefined %КОСТЫЛЬ
\usepackage{amsfonts,amsmath,amsthm} % математические дополнения от АМС
\usepackage{indentfirst} % отделять первую строку раздела абзацным отступом тоже
\usepackage[usenames,dvipsnames]{color} % названия цветов
\usepackage{makecell}
\usepackage{multirow} % улучшенное форматирование таблиц
%\usepackage{ulem} % подчеркивания
\usepackage{longtable} %длинные таблицы
\usepackage{ragged2e}
\usepackage{float}
\usepackage{pdfpages}
\usepackage[table]{xcolor}
\usepackage[obeyDraft]{todonotes}
%%%%%%%%%%%%%%%%%%%%%%%%%%
% КОЛОНТИТУЛЫ
%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\fontfamily{\familydefault}\fontsize{14pt}{14pt}\selectfont\thepage}
\fancyheadoffset{0mm}
\fancyfootoffset{10mm}
\setlength{\headheight}{17pt}%17pt
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\fancypagestyle{plain}{%
  \fancyhf{}
  \rhead{\fontfamily{\familydefault}\fontsize{14pt}{14pt}\selectfont\thepage}}
%\setcounter{page}{} % начать нумерацию страниц с №5

%%%%%%%%%%%%%%%%%%%%%%%%%%
% ПОДПИСИ К РИСУНКАМ
%%%%%%%%%%%%%%%%%%%%%%%%%%
%TODO: fix the issue with breaking paragraph by picture when it is float object

\usepackage[tableposition=top]{caption}
\usepackage{subcaption}
\DeclareCaptionLabelFormat{gostfigure}{Рисунок #2}
\DeclareCaptionLabelFormat{gosttable}{\hspace{0.75cm}Таблиця #2}
\DeclareCaptionLabelFormat{gostlisting}{\hspace{0.75cm}Лістинг #2}
\DeclareCaptionLabelSeparator{gost}{~---~}
\captionsetup{labelsep=gost}
\captionsetup[table]{%
  format=plain,
  justification=justified,%width=\linewidth,
  indention=0cm,
  font={stretch=1.464},
  singlelinecheck=false,
  labelformat=gosttable}

\captionsetup[lstlisting]{%
  format=plain,
  justification=justified,%width=\linewidth,
  indention=0cm,
  font={stretch=1.464},
  singlelinecheck=false,
  labelformat=gostlisting}

\captionsetup[figure]{%
  labelformat=gostfigure,
  indention=0cm,
  justification=centering,
  margin={0cm,14pt},
  font={stretch=1.464},
  indention=0cm}

\setlength{\textfloatsep}{0pt}
\setlength{\floatsep}{10pt}
\setlength{\intextsep}{10pt}
\setlength{\abovecaptionskip}{5pt}
\setlength{\belowcaptionskip}{-5pt}

\newcommand\fnote[1]{%
\justify
\setstretch{1.464}
{\hspace{1.25cm}#1}
}

\renewcommand{\thesubfigure}{\asbuk{subfigure}}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% МЕЛОЧИ
%%%%%%%%%%%%%%%%%%%%%%%%%%
\parindent=1.25cm
\usepackage{ulem}
\usepackage{gensymb}
\usepackage{setspace}
%\usepackage[nodisplayskipstretch]{setspace}
\newcommand{\cels}{~${}^{\circ}C$}
\newcommand{\signline}{\rule{1.25in}{.5pt}}
\newcommand{\inputdateblank}{%
{,,}\rule{0.7cm}{.5pt}{\/``}\enspace\hrulefill~\the\year~р.}
%\newdateformat{mydate}{,,\underline{\THEDAY}\/``~\underline{\THEMONTH}~\THEYEAR~p.}

\newenvironment{eqitemize}
  {\itemize[label=,leftmargin=\widthof{де\enspace}]}
  {\enditemize}

%выключаем переносы и делаем выравнивание текста Word-like
\tolerance=1
\emergencystretch=\maxdimen
\hyphenpenalty=10000
\hbadness=10000


\usepackage[bookmarks=true,
            xetex,
            unicode=true]{hyperref}
%\usepackage{bookmark}
%\PassOptionsToPackage{unicode}{hyperref}
%\PassOptionsToPackage{naturalnames}{hyperref}
\hypersetup{
final=true,
 colorlinks,
  citecolor=black,
  filecolor=black,
  linkcolor=black,
  urlcolor=black}

\expandafter\def\expandafter\normalsize\expandafter{%
    \normalsize
    \setlength\abovedisplayskip{2pt}
    \setlength\belowdisplayskip{2pt}
    \setlength\abovedisplayshortskip{2pt}
    \setlength\belowdisplayshortskip{2pt}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%
% ЛИСТИНГИ
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{listings}

\lstset{% general command to set parameter(s)
  breaklines=true,
  inputencoding=utf8,
  %extendedchars=\true,
  frame=single,
  basicstyle=\linespread{1}\footnotesize,      % print whole listing small
  keywordstyle=\color{black}\bfseries\underbar,
  % underlined bold black keywords
  %identifierstyle=,           % nothing happens
  commentstyle=\color{gray}, % white comments
  %stringstyle=\ttfamily,      % typewriter type for strings
  showstringspaces=true,
  showspaces=false,
  %numbers=left,
  %stepnumber=1,
  %firstnumber=1,
  tabsize=2,
  caption=\lstname
  %numberfirstline=true
}

\renewcommand{\lstlistingname}{Лістинг}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% ОГЛАВЛЕНИЯ
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{titlesec}

\titleformat{\chapter}[hang]
{\filcenter}
%{\MakeUppercase{\chaptertitlename} \thechapter}
{\bfseries\thechapter}
{8pt}
{\bfseries}{}

\titleformat{\section}[block]
{\normalsize\bfseries}
{\thesection}
{1em}{}

\titleformat{\subsection}[block]
{\normalsize\bfseries}
{\thesubsection}
{1em}{}

% Настройка вертикальных и горизонтальных отступов
\titlespacing*{\chapter}{0pt}{-30pt}{30pt}
\titlespacing*{\section}{\parindent}{*4}{*4}
\titlespacing*{\subsection}{\parindent}{*4}{*4}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% LIKECHAPTER
%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\empline}{\mbox{}\newline}
\newcommand{\likechapterheading}[1]{%
  \begin{center}
    \textbf{#1}
  \end{center}
  \vspace{15pt} %УЖЕ ПОДПРАВИЛ БОЛЕЕ-МЕНЕЕ
  %\empline
}

\makeatletter
\renewcommand{\@dotsep}{1}
\newcommand{\l@likechapter}[2]{{\@dottedtocline{0}{0pt}{0pt}{#1}{#2}}}
\providecommand*{\toclevel@likechapter}{10}
\makeatother

\newcommand{\likechapter}[1]{
  \newpage
  \pdfbookmark[0]{#1}{#1}
  \likechapterheading{#1}
  \addcontentsline{toc}{likechapter}{#1}
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%
% ПРИЛОЖЕНИЯ
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[title]{appendix}

\titleformat{\paragraph}[display]
{\filcenter}
{\thechapter}
{8pt}
{\hspace{1.4in} ДОДАТОК \thechapter \newline \bfseries}{}
\titlespacing*{\paragraph}{0pt}{0pt}{-40pt}

\newcommand{\append}[1]{%
  \newpage
  %\stepcounter{chapter}%\chaptermark{#1}
  \refstepcounter{chapter}
  \pdfbookmark[0]{ДОДАТОК~\thechapter~#1}{ДОДАТОК~\thechapter~#1}
  \paragraph{#1}
  \empline
  \addcontentsline{toc}{likechapter}{ДОДАТОК~\thechapter~\;#1}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% ЗМІСТ
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{tocloft}
\tocloftpagestyle{empty}
\renewcommand{\cfttoctitlefont}{\hspace{0.435\textwidth} \bfseries\MakeUppercase}
\renewcommand\cftchappagefont{\normalfont}
\renewcommand{\cftbeforetoctitleskip}{-1em}
\renewcommand{\cftaftertoctitle}{\mbox{}\hfill \\ \mbox{}\hfill{%\footnotesize Стор.
             }\vspace{-2.5em}}
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftchapfont}{}
%\renewcommand{\cftsecfont}{\hspace{0pt}} % было 31pt
%renewcommand{\cftsubsecfont}{\hspace{0pt}} % было 11pt
\renewcommand{\cftbeforechapskip}{0em}
%\renewcommand{\cftafterchapskip}{1em}
\renewcommand{\cftparskip}{-1mm}
\renewcommand{\cftdotsep}{1}

%\renewcommand{\cftchapnumwidth}{32pt}
%\setlength{\cftchapindent}{-32pt}

\setcounter{tocdepth}{2} % задать глубину оглавления — до section включительно

%%%%%%%%%%%%%%%%%%%%%%%%%%
% ПОЛЯ
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{geometry}
\geometry{left=2.5cm}
\geometry{right=1cm}
\geometry{top=2cm}
\geometry{bottom=2cm}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% СПИСКИ
%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{enumitem}
\makeatletter
\AddEnumerateCounter{\asbuk}{\@asbuk}{м)}
\makeatother
\setlist{nolistsep,leftmargin=\widthof{---\enspace}+1.25cm}
%\setlist{}
\renewcommand{\labelitemi}{---}
\renewcommand{\labelenumi}{\asbuk{enumi})}
\renewcommand{\labelenumii}{\arabic{enumii})}

%%%%%%%%%%%%%%%%%%%%%%%%%%
% СПИСОК ЛИТЕРАТУРЫ
%%%%%%%%%%%%%%%%%%%%%%%%%%
%\usepackage{gost}
\usepackage[square,numbers,sort&compress]{natbib}
%\renewcommand{\bibnumfmt}[1]{#1.\hfill} % нумерация источников в самом списке — через точку
\renewcommand\bibnumfmt[1]{\hphantom{99.}\llap{#1.}}
\renewcommand{\bibsection}{\likechapter{СПИСОК ВИКОРИСТАНИХ ДЖЕРЕЛ}} % заголовок специального раздела
\setlength{\bibsep}{0pt}
\bibliographystyle{ugost2003}

%TODO: move or delete this
\makeatletter
\newcommand\thefontsize[1]{{#1 The current font size is: \f@size pt\par}}
\makeatother
